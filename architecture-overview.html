<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Communicator Overview - Modern Interoperable Messaging</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="architecture-overview.html" class="active">Communicator Overview</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Relationship Concepts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="authentication.html"><strong aria-hidden="true">1.1.</strong> Authentication</a></li><li class="chapter-item expanded "><a href="durability.html"><strong aria-hidden="true">1.2.</strong> Durability</a></li><li class="chapter-item expanded "><a href="principles-permission.html"><strong aria-hidden="true">1.3.</strong> Permission to Contact</a></li><li class="chapter-item expanded "><a href="interoperability.html"><strong aria-hidden="true">1.4.</strong> Interoperability</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Technical Concepts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="relationships.html"><strong aria-hidden="true">2.1.</strong> Relationships</a></li><li class="chapter-item expanded "><a href="groups.html"><strong aria-hidden="true">2.2.</strong> Groups</a></li><li class="chapter-item expanded "><a href="introductions.html"><strong aria-hidden="true">2.3.</strong> Introductions</a></li><li class="chapter-item expanded "><a href="identities.html"><strong aria-hidden="true">2.4.</strong> Identities</a></li><li class="chapter-item expanded "><a href="devices.html"><strong aria-hidden="true">2.5.</strong> Multiple Devices</a></li><li class="chapter-item expanded "><a href="recovery.html"><strong aria-hidden="true">2.6.</strong> Recovery</a></li><li class="chapter-item expanded "><a href="client-protocol.html"><strong aria-hidden="true">2.7.</strong> Client App Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="reference-implementations.html"><strong aria-hidden="true">3.</strong> Reference Implementations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="reference/directory-service.html"><strong aria-hidden="true">3.1.</strong> Directory Service</a></li><li class="chapter-item expanded "><a href="reference/sending-service.html"><strong aria-hidden="true">3.2.</strong> Sender's Service Agent</a></li><li class="chapter-item expanded "><a href="reference/receiving-service.html"><strong aria-hidden="true">3.3.</strong> Receiver's Service Agent</a></li></ol></li><li class="chapter-item expanded "><a href="related-work.html"><strong aria-hidden="true">4.</strong> Related Work</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Modern Interoperable Messaging</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="communicator-a-protocol-for-durable-consensual-conversations"><a class="header" href="#communicator-a-protocol-for-durable-consensual-conversations">Communicator: a protocol for durable, consensual conversations</a></h1>
<h2 id="problem"><a class="header" href="#problem">Problem</a></h2>
<p>Messaging today has a fundamental architectural problem in that we overload addresses (e.g. phone numbers or email addresses) as identity. This unexpectedly fractures conversations across different transport mediums, and when people change addresses. 
People have to manually unify conversations across addresses by maintaining a contacts database that maps people to their many addresses. Because addresses convey identify, it exposes metadata in transit about who is talking to each other.</p>
<p>Messaging also has a conceptual problem in that we assume, implicitly if not explicitly, that a person has one identity in any system. From those identities, we derive the concept of messages by directing data from one identity to some set of recipient identities, and we can then collect messages into conversations by organizing individual messages in relation to each other, or by the set of participating identities.</p>
<p>This construction leads to an architectural default that anyone can message anyone else, enabing spam and harassment, as it is costlier for a victim to change addresses than for an attacker to evade sender-identity blocking. In turn, this incentivizes systems to be hostile to using multiple identities. There is no architectural distinction between a solicited and unsolicited message, so systems rely on data about who we have messaged, and who we know (contacts databases) to infer the notion of a consensual relationship. </p>
<p>The Communicator architecture addresses these problems by making a relationship between two people the core concept, and decoupling identity at the application layer, from the addresses used for transport. </p>
<h2 id="protocol"><a class="header" href="#protocol">Protocol</a></h2>
<p>The Communicator architecture is a messaging protocol that enables people to asynchronously create relationships and  exchange messages in those relationships. It extends the core idea of Double Ratchet key management - that two parties protect their communications with shared secrets that are updated with each message exchange - to the addresses that they use to deliver those messages to each other. </p>
<p>Two parties Alex and Blair consensually create a Communicator relationship by exchanging data that allows them to create an authenticated encryption session, and transport messages in that session with each other. This dynamic state that allows Alex and Blair to securely exchange messages is stored in a data structure we call a Particle, to reflect the intuition that Alex and Blair each have a corresponding data structure, entangled through message exchange.</p>
<h3 id="continue-existing-conversations"><a class="header" href="#continue-existing-conversations">Continue existing conversations</a></h3>
<p>Once Alex and Blair have established a Communicator relationship, they can use it to send messages in the following way:</p>
<p><img src="img/message-exchange.png" alt="sending a message in a relationship" /></p>
<p>Alex and Blair each enlist the help of multiple, persistently online services to perform the asymmetric roles of sending and receiving messages, each acting as one party's agent.  Alex's state (Particle) for their relationship with Blair contains information about Blair's <a href="reference/receiving-service.html">receiving service agents</a>, and addresses for Blair at each of those receiving services.</p>
<p>When Alex has a message to send to Blair, Alex attaches to the plaintext any updates to their Particle state (e.g. updates to Alex's receiving services or addresses), and encrypts the message to Blair using the agreed-upon key schedule.</p>
<p>To transmit this ciphertext, Alex chooses one of their sending services and one of Blair's receiving services. Alex can then route the message by presenting Alex's chosen sending service:</p>
<ul>
<li>The message ciphertext</li>
<li>A URI for the chosen receiving service</li>
<li>an address for Blair at that receiving service</li>
</ul>
<p>The sending service does not need to know Blair's address, so Alex encrypts it with a public key published by the Receiving Service.</p>
<h3 id="start-new-relationships"><a class="header" href="#start-new-relationships">Start new relationships</a></h3>
<p>Initializing a Communicator relationship requires a bidirectional exchange of keys and addresses. In the simplest manner, Alex and Blair may simply exchange these directly between their devices through a local, peer to peer transport such as Bluetooth.</p>
<p>In many cases, Alex and Blair will rely on a persistently online Directory Service to broker an asynchronous, remote exchange. </p>
<h4 id="brokered-directory-service"><a class="header" href="#brokered-directory-service">Brokered Directory Service</a></h4>
<p>The most full-featured directory service can vend keys (long-term identity key and prekeys - call this a KeyPackage) and addresses for names within a namespace they assert authority over.</p>
<p><img src="img/brokered-directory.png" alt="brokered directory service" /></p>
<p>This architecture resembles the deployment of most end to end encrypted messaging services today (Signal, iMessage, WhatsApp).</p>
<p>The directory service in this role grants permission to contact, and may subject this permission to rules within its own namespace.</p>
<h4 id="attesting-directory-service"><a class="header" href="#attesting-directory-service">Attesting Directory Service</a></h4>
<p>Directory services can also attest to bindings of identity (keys) with names in their namespace without granting permission to contact by issuing addresses. This is useful for establishing trust for relationships established through an intermediary - either an insecure medium, or via a person to person introduction.</p>
<p><img src="img/attested-directory.png" alt="attesting directory service" /></p>
<h2 id="considerations"><a class="header" href="#considerations">Considerations</a></h2>
<p>This architecture is alike SMTP in that senders and recipients make independent choices of agents for sending and receiving messages, analogously to mail submission agents and mail delivery agents. Unlike SMTP, these agents only handle ciphertexts, and clients are responsible for storage of plaintext messages. They may choose to enlist the aid of additional services to help synchronize this storage across devices, or provide recovery in case of device loss.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="next" href="authentication.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="next" href="authentication.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
