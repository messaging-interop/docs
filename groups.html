<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Groups - Modern Interoperable Messaging</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="architecture-overview.html">Communicator Overview</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Relationship Concepts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="authentication.html"><strong aria-hidden="true">1.1.</strong> Authentication</a></li><li class="chapter-item expanded "><a href="durability.html"><strong aria-hidden="true">1.2.</strong> Durability</a></li><li class="chapter-item expanded "><a href="principles-permission.html"><strong aria-hidden="true">1.3.</strong> Permission to Contact</a></li><li class="chapter-item expanded "><a href="interoperability.html"><strong aria-hidden="true">1.4.</strong> Interoperability</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Technical Concepts</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="relationships.html"><strong aria-hidden="true">2.1.</strong> Relationships</a></li><li class="chapter-item expanded "><a href="groups.html" class="active"><strong aria-hidden="true">2.2.</strong> Groups</a></li><li class="chapter-item expanded "><a href="introductions.html"><strong aria-hidden="true">2.3.</strong> Introductions</a></li><li class="chapter-item expanded "><a href="identities.html"><strong aria-hidden="true">2.4.</strong> Identities</a></li><li class="chapter-item expanded "><a href="devices.html"><strong aria-hidden="true">2.5.</strong> Multiple Devices</a></li><li class="chapter-item expanded "><a href="recovery.html"><strong aria-hidden="true">2.6.</strong> Recovery</a></li><li class="chapter-item expanded "><a href="client-protocol.html"><strong aria-hidden="true">2.7.</strong> Client App Protocol</a></li></ol></li><li class="chapter-item expanded "><a href="reference-implementations.html"><strong aria-hidden="true">3.</strong> Reference Implementations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="reference/directory-service.html"><strong aria-hidden="true">3.1.</strong> Directory Service</a></li><li class="chapter-item expanded "><a href="reference/sending-service.html"><strong aria-hidden="true">3.2.</strong> Sender's Service Agent</a></li><li class="chapter-item expanded "><a href="reference/receiving-service.html"><strong aria-hidden="true">3.3.</strong> Receiver's Service Agent</a></li></ol></li><li class="chapter-item expanded "><a href="related-work.html"><strong aria-hidden="true">4.</strong> Related Work</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Modern Interoperable Messaging</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="groups"><a class="header" href="#groups">Groups</a></h1>
<p>A group is a set of people who want to talk amongst themselves. Whereas the Particle data structure for a 1:1 relationship containes keys and addresses for person at the other end of the relationship, the Group Particle data structure contains the same data (keys and addresses) for all other participants. For a Group \(G\), the member \(G_c\) would have the following data structure</p>
<ul>
<li>(optional) A name for the group</li>
<li>(optional) A profile picture for the group</li>
<li>For each other group member \(GP_i\):
<ul>
<li>The group member's preferred presentation:
<ul>
<li>A string representing a preferred name</li>
<li>Optionally, pronouns</li>
<li>Optionally, a profile picture</li>
</ul>
</li>
<li>An Identity Public Key (\(IPK_i\))
<ul>
<li>Optionally, an external resource that attests to a link between \(IPK_i\) and some external identity (e.g. a scoped username like an email address)</li>
</ul>
</li>
<li>A list of <a href="reference/receiving-service.html">receiver's service agents</a> (minimum 2), that each contains
<ul>
<li>A URL representing the service identity and a means to obtain the service's configuration:
<ul>
<li>E.g. <code>example.com/.well-known/Communicator.json</code>
(analogous to an MX record)</li>
</ul>
</li>
<li>A long-term delivery address for \(P_b\)(this facilitates recovery)
<ul>
<li>With a guaranteed valid until date</li>
</ul>
</li>
<li>An ephemeral delivery address for \(P_b\)
<ul>
<li>With a short expiry date</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>An Identity private key for \(IPK_c\) corresponding to the \(IPK_i\) held by other group members
<ul>
<li>A set of associations of \(IPK_c\) with other related Particles (relationships)defined by cryptographic attestation - see [Identity].</li>
</ul>
</li>
<li>An Identity private key for \(GP_c\) corresponding to the \(IPK_c\) held by other members of the group</li>
<li>Message Security state variables
<ul>
<li>discussed later in this document</li>
</ul>
</li>
</ul>
<p>This is sufficient for a group to talk amongst themselves - agreement with other participants on who (defined by Identity Public Keys) is a member of this group, and how to deliver messages to them. </p>
<h2 id="group-management"><a class="header" href="#group-management">Group Management</a></h2>
<p>There is a range of approaches to handle consistenty of group membership and message ordering; here are a few examples:</p>
<h3 id="fully-decentralized"><a class="header" href="#fully-decentralized">Fully Decentralized</a></h3>
<p>Each message has a set of recipients. Membership is implicitly changed by changing the recipient list for new messsages. Messages are not fully ordered - messages can be relatively ordered to indicate a reply. Email and iMessage function in this way (as do legacy Signal groups). Race conditions may cause groups (and conversations) to fork.</p>
<h3 id="centralized-membership-decentralized-message-delivery"><a class="header" href="#centralized-membership-decentralized-message-delivery">Centralized Membership, Decentralized message delivery</a></h3>
<p>Members of a group agree on an authoritative source of group membership (and other group metadata like a name), but do not rely on an external resource (like a server) to adjudicate consistent message ordering. Signal's private groups function in this way. </p>
<h3 id="centralized-membership-and-message"><a class="header" href="#centralized-membership-and-message">Centralized Membership and Message</a></h3>
<p>Chat rooms, mailing lists, and Slack, are examples of this. There is a single source of truth for message ordering - participants compete to edit a collaborative, (mostly) append-only document that is the room's message transcript. The room (and implicitly, the room operator) is the fundamental entity, not the set of participants that make up the group.</p>
<p>These different approaches are suitable, roughly speaking, for groups of increasing size. The Communicator architecture has the following two approaches to group management:</p>
<h2 id="lightweight-groups"><a class="header" href="#lightweight-groups">Lightweight Groups</a></h2>
<p>These groups operate in the fully decentralized way. The Message security state is a pairwise double ratchet state for each member of the group.</p>
<h2 id="coordinated-groups"><a class="header" href="#coordinated-groups">Coordinated Groups</a></h2>
<p>These groups leverage a server agent to store the group's state (e.g. membership), and as the single Sender's Service Agent for the entire group. This allows it to perform the message ordering required by Message Layer Security. Here, the message security will be provided by MLS, not pairwise Double Ratchet.</p>
<p>Coordinated groups are robust against failure or denial of service by the server agent by falling back to a lightweight group, and can nominate another server agent to take over. </p>
<p>The Application layer can choose between these architectures when forming a group, and can add coordination to a lightweight group at anytime. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="relationships.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="introductions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="relationships.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="introductions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
